<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fun House: Ready to Play</title>
    <style>
        :root { --wa-green: #25D366; --wa-dark: #075E54; --truth: #34B7F1; --dare: #e91e63; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--wa-dark); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 10px; box-sizing: border-box; }
        .card { background: white; padding: 20px; border-radius: 25px; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 15px 30px rgba(0,0,0,0.3); }
        
        .lobby-status { background: #f0f4f8; padding: 12px; border-radius: 15px; margin-bottom: 15px; border: 2px solid #d1d9e6; }
        .player-chip { display: inline-block; background: #ddd; color: #333; padding: 5px 10px; border-radius: 20px; margin: 3px; font-size: 0.8rem; font-weight: bold; }
        .player-chip.ready { background: var(--wa-green); color: white; }

        .game-box { position: relative; width: 260px; height: 260px; margin: 15px auto; border-radius: 50%; border: 8px solid #333; background: #eee; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #999; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; position: absolute; top:0; left:0; display: none; transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); }
        
        #bottle { position: absolute; top: 50%; left: 50%; width: 16px; height: 150px; background: #222; margin-top: -75px; margin-left: -8px; border-radius: 10px; z-index: 10; display: none; }
        #bottle::after { content: 'üçæ'; position: absolute; top: -15px; left: -10px; font-size: 34px; transform: rotate(-45deg); }

        .name-label { position: absolute; font-weight: bold; font-size: 11px; color: #333; transform: translate(-50%, -50%); width: 70px; text-align: center; z-index: 15; background: rgba(255,255,255,0.9); padding: 2px; border-radius: 5px; }

        .btn { border: none; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 8px; padding: 14px; font-size: 1rem; transition: 0.2s; }
        .btn-join { background: #333; color: white; }
        .btn-ready { background: var(--truth); color: white; }
        .btn-spin { background: var(--wa-green); color: white; box-shadow: 0 5px 0 #128C7E; display: none; }
        
        #resultBox { margin-top: 15px; padding: 15px; border-radius: 15px; background: #f9f9f9; display: none; border: 2px solid var(--wa-green); }
    </style>
</head>
<body>

<div class="card">
    <div class="lobby-status">
        <div id="statusTitle" style="font-weight:bold; margin-bottom:5px;">LOBBY</div>
        <div id="chipContainer"></div>
        <div id="lockMsg" style="font-size: 0.75rem; color: #e74c3c; margin-top:5px;">Add names and click "I'm Ready"</div>
    </div>

    <button class="btn btn-join" id="joinBtn" onclick="addPlayer()">‚ûï TYPE NAME</button>
    <button class="btn btn-ready" id="readyBtn" onclick="markReady()" style="display:none;">‚úîÔ∏è I'M READY</button>
    <button class="btn btn-spin" id="spinBtn" onclick="startSpin()">SPIN THE BOTTLE üçæ</button>

    <div class="game-box" id="arena">
        <span id="placeholderTxt">WAITING FOR PLAYERS...</span>
        <div id="wheel"></div>
        <div id="bottle"></div>
    </div>

    <div id="resultBox">
        <b style="font-size: 1.3rem;" id="victimName"></b><br>
        <p id="challengeText" style="font-style: italic; color: #444; margin: 10px 0;"></p>
        <button class="btn" style="background:var(--wa-dark); color:white;" onclick="sendToWA()">Share to WhatsApp üí¨</button>
    </div>
</div>

<script>
    let players = [];
    let readyCount = 0;
    let currentRot = 0;
    const tasks = ["Tell a deep secret", "Do a funny dance", "Truth: Who do you like?", "Dare: Post a selfie", "Truth: Biggest ick?"];

    function addPlayer() {
        const name = prompt("Enter your name:");
        if (name && name.trim() !== "") {
            players.push({ name: name.trim(), isReady: false });
            updateUI();
        }
    }

    function markReady() {
        // Find the first player who isn't ready and mark them
        const nextToReady = players.find(p => !p.isReady);
        if (nextToReady) {
            nextToReady.isReady = true;
            readyCount++;
            updateUI();
        }
    }

    function updateUI() {
        const chips = document.getElementById('chipContainer');
        const rBtn = document.getElementById('readyBtn');
        const sBtn = document.getElementById('spinBtn');
        const jBtn = document.getElementById('joinBtn');
        const msg = document.getElementById('lockMsg');
        
        // Show chips
        chips.innerHTML = players.map(p => `<span class="player-chip ${p.isReady ? 'ready' : ''}">${p.name}</span>`).join('');
        
        // Logic for Ready Button
        rBtn.style.display = (players.length > readyCount) ? "block" : "none";
        
        // The Big Check: 2 or more players AND all players are ready
        if (players.length >= 2 && readyCount === players.length) {
            jBtn.style.display = "none";
            rBtn.style.display = "none";
            sBtn.style.display = "block";
            msg.innerText = "GAME START! ‚úÖ";
            msg.style.color = "var(--wa-green)";
            generateWheel();
        } else if (players.length >= 2) {
            msg.innerText = `${players.length - readyCount} player(s) still need to click Ready`;
            msg.style.color = "#f39c12";
        }
    }

    function generateWheel() {
        const wheel = document.getElementById('wheel');
        const arena = document.getElementById('arena');
        const bottle = document.getElementById('bottle');
        const placeholder = document.getElementById('placeholderTxt');

        placeholder.style.display = "none";
        wheel.style.display = "block";
        bottle.style.display = "block";

        const step = 360 / players.length;
        let colors = [];
        players.forEach((p, i) => {
            const color = (i % 2 === 0) ? '#ffffff' : '#f0f0f0';
            colors.push(`${color} ${i * step}deg ${(i + 1) * step}deg`);

            const angle = (i * step + step / 2) * (Math.PI / 180);
            const x = 130 + 85 * Math.cos(angle - Math.PI/2);
            const y = 130 + 85 * Math.sin(angle - Math.PI/2);
            
            const label = document.createElement('div');
            label.className = 'name-label';
            label.style.left = x + 'px'; label.style.top = y + 'px';
            label.innerText = p.name;
            arena.appendChild(label);
        });
        wheel.style.background = `conic-gradient(${colors.join(', ')})`;
    }

    function startSpin() {
        document.getElementById('spinBtn').disabled = true;
        document.getElementById('resultBox').style.display = "none";
        
        const vIdx = Math.floor(Math.random() * players.length);
        const step = 360 / players.length;
        const targetAngle = vIdx * step + (step / 2);
        
        currentRot += 1800 + (360 - (currentRot % 360)) + targetAngle;
        document.getElementById('wheel').style.transform = `rotate(-${currentRot}deg)`;

        setTimeout(() => {
            const prompt = tasks[Math.floor(Math.random() * tasks.length)];
            document.getElementById('victimName').innerText = players[vIdx].name;
            document.getElementById('challengeText').innerText = `"${prompt}"`;
            document.getElementById('resultBox').style.display = "block";
            document.getElementById('spinBtn').disabled = false;
        }, 4000);
    }

    function sendToWA() {
        const v = document.getElementById('victimName').innerText;
        const c = document.getElementById('challengeText').innerText;
        const msg = `*FUN HOUSE RESULT*\nüéØ *Victim:* ${v}\nüìú *Task:* ${c}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }
</script>
</body>
</html>
